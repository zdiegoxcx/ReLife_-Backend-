<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= categoryName %> - ReLife</title>
    <link rel="stylesheet" href="/css/styles.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Estilos específicos para esta vista (para no ensuciar el styles.css global) */
        .category-header {
            margin-bottom: 30px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-title {
            font-size: 2rem;
            color: #fff;
            margin: 0;
            border-left: 5px solid var(--color-brand-green);
            padding-left: 15px;
        }

        /* Sobrescribimos el grid para que aquí SÍ salte de línea (no carrusel) */
        .full-grid {
            display: flex;
            flex-wrap: wrap; /* Permite que bajen a la siguiente línea */
            gap: 20px;
            justify-content: flex-start;
        }
        
        /* Ajuste para que las tarjetas no se estiren raro */
        .full-grid .product-item {
            width: 180px; /* Ancho fijo consistente */
            flex: none;
        }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="logo"><a href="/"><span class="re-white">RE</span>LIFE</a></div>
        <div class="welcome-user" id="user-display">Cargando...</div>
        <a href="/" class="logout-btn" style="text-decoration: none;">Volver al Inicio</a>
    </header>

    <main class="content" style="flex-direction: column; align-items: stretch;">
        
        <div class="product-catalog" style="overflow: visible;"> <div class="category-header">
                <h1 class="category-title"><%= categoryName %></h1>
                <span style="color: #888;"><%= products.length %> productos encontrados</span>
            </div>

            <div class="full-grid">
                
                <% if (products && products.length > 0) { %>
                    
                    <% products.forEach((producto) => { %>
                        <div class="product-item" onclick="verDetalleProducto(<%= producto.tdp_id %>)" style="cursor: pointer;">
                            
                            <img src="<%= producto.timg_url || 'https://via.placeholder.com/150?text=Sin+Foto' %>" alt="<%= producto.tdp_nmb %>">
                            
                            <p><%= producto.tdp_nmb %></p>
                            <p class="price">$ <%= producto.tdp_pre %></p>
                        
                        </div>
                    <% }) %>

                <% } else { %>
                    <div style="width: 100%; text-align: center; padding: 50px; color: #bbb;">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 10px; display: block;"></i>
                        <p>No hay productos en esta categoría todavía.</p>
                        <a href="/" style="color: var(--color-brand-green);">Volver a ver todo</a>
                    </div>
                <% } %>

            </div>

        </div>
    </main>

    <script>
        // 1. Mostrar usuario en el header
        document.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem('userEmail');
            const display = document.getElementById('user-display');
            if(userEmail && display) {
                display.textContent = 'BIENVENIDO ' + userEmail.split('@')[0].toUpperCase();
            }
        });

        // 2. Función de Seguridad (La misma del Home)
        function verDetalleProducto(id) {
            const usuarioLogueado = localStorage.getItem('userEmail');

            if (usuarioLogueado) {
                window.location.href = '/product/' + id;
            } else {
                const deseaIrAlLogin = confirm('Debes iniciar sesión para ver los detalles.\n\n¿Quieres ir a Iniciar Sesión ahora?');
                if (deseaIrAlLogin) {
                    window.location.href = '/login';
                }
            }
        }
    </script>
</body>
</html>